## 学習 / 作業 時間

2 時間

## 今日取り組んだこと

- Next.js の復習
  - app ディレクトリの構造について

## 学んだこと・気づいたこと

- `layout.tsx` は その配下のすべてのページで共有される UI
- 条件次第で普通に再レンダリングされる
- 特に サーバーコンポーネントであるため、リクエストごとに再実行される可能性がある
- ただし、**React のクライアント側での再レンダリングとは挙動が異なる**

#### **重要：Next.js のレンダリング = React のレンダリングではない**

Next.js（App Router）は、

- **サーバーコンポーネント**
- **クライアントコンポーネント**

の 2 種類があるため、「レンダリング」という言葉が複数の意味を持ちます。

#### ① layout.tsx はサーバーコンポーネント

App Router では、ファイルは "use client" がない限りサーバーコンポーネント です。

つまり layout.tsx は基本的に サーバーで実行される JS。

#### ② サーバーコンポーネントは「必要に応じて」毎リクエスト再実行される

Next.js 公式より：

- サーバーコンポーネント = リクエストベースで実行（再レンダリング）され得る
- ただし、静的最適化（SSG）される場合は キャッシュされて再実行されない

つまり layout.tsx はこうなる：

| 状況                                                              | layout.tsx のレンダリング           |
| ----------------------------------------------------------------- | ----------------------------------- |
| デフォルト（静的最適化が有効）                                    | 初回だけ実行 → **キャッシュ**される |
| 動的な処理が含まれる場合（cookies, headers, fetch no-cache など） | **毎回再実行される**                |
| cache 設定に応じて                                                | 再実行したりしなかったり            |

#### ③ layout.tsx がクライアント側で再レンダリングされることは少ない

理由：

- layout.tsx は Server Component のため、
  React の useState / useEffect は使用できない
- React 側の「state 変化による再レンダリング」は発生しない

つまり：

クライアント側のレンダリング = UI の更新 が layout.tsx で起こるケースはほぼ無い

#### ⭐ 最重要ポイントまとめ

✔ layout.tsx は “再レンダリングされない” と思っている人が多い

→ ❌ 正しくは「条件付きで再レンダリングされる」

✔ ただしこれは「サーバーでの再実行」の話

→ React のクライアントレンダリングとは別物

✔ クライアント側では基本的に変化しない

→ layout.tsx は useState や useEffect を持たないため、

ページ遷移しても UI がいちいち再描画されることはない

#### 🔍 補足：なぜ layout.tsx は「共有 UI」なのか

layout.tsx の役割：

- ページ間遷移で 不変である UI を共通化するため
- 例：ヘッダー、サイドバー、フッターなど

React のクライアント側ではこれらは 保持され続ける

＝ ページ遷移で「消えずに残る」

これは

“クライアント側で再レンダリングされない” という意味ではない

正確には：

“React の Client Component としては再レンダリングされない設計になっている”

## 不明点・課題

- [x] layout.tsx は ページ間で共有される UI であり、再レンダリングされることはないのか？
- [ ] サーバーコンポーネントとクライアントコンポーネントの違い
- [ ] React とのレンダリングの違いをもっと詳細に知りたい

## メモ

## 次やること
